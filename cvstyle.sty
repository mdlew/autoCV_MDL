%% cvstyle.sty -- shared preamble, macros, and layout for cv.tex
\NeedsTeXFormat{LaTeX2e}
\ProvidesPackage{cvstyle}[2025/11/04 v1.0 MDL CV style]

% -------------------------
% Packages (grouped & ordered)
% -------------------------
\RequirePackage{url}
\RequirePackage{parskip}

\RequirePackage{color}
\RequirePackage{graphicx}
\RequirePackage[usenames,dvipsnames]{xcolor}
\RequirePackage[scale=0.9]{geometry}

% page numbering / header & footer
\RequirePackage{lastpage}
\RequirePackage{fancyhdr}

% marking section titles for footer
\makeatletter
\renewcommand{\sectionmark}[1]{\markright{#1}}
\renewcommand{\subsectionmark}[1]{\markright{#1}}
\makeatother

\pagestyle{fancy}
\renewcommand{\headrulewidth}{0pt}
\fancyhf{}
\fancyfoot[L]{\footnotesize MDL CV -- \nouppercase{\rightmark}}
\fancyfoot[R]{\footnotesize \thepage\ of \pageref{LastPage}}
\fancypagestyle{plain}{%
  \renewcommand{\headrulewidth}{0pt}%
  \fancyhf{}%
  \fancyfoot[L]{\footnotesize MDL CV -- \nouppercase{\rightmark}}%
  \fancyfoot[R]{\footnotesize \thepage\ of \pageref{LastPage}}%
}
\AtBeginDocument{\thispagestyle{empty}}

% layout helpers
\RequirePackage{tabularx}
\newcommand{\tablerowskip}{3.75pt}

\RequirePackage{enumitem}
\RequirePackage{etaremune}
\RequirePackage{supertabular}
\newlength{\fullcollw}
\setlength{\fullcollw}{0.47\textwidth}

\RequirePackage{titlesec}
\RequirePackage{multicol}
\RequirePackage{multirow}

\titleformat{\section}{\Large\scshape\raggedright}{}{0em}{}[\titlerule]
\titlespacing{\section}{0pt}{10pt}{10pt}
\titleformat{\subsection}{\bfseries\raggedright}{}{0em}{}
\titlespacing{\subsection}{0pt}{10pt}{\tablerowskip}

% Bibliography
\RequirePackage[style=science, maxnames=99, articletitle=true, date=year, isbn=false, eprint=false, url=false]{biblatex}
\RequirePackage{biblatex_science_mods}

% icons
\RequirePackage{fontawesome7}

% PDF/A and hyperlinks
\RequirePackage[a-2b]{pdfx}
\RequirePackage[open]{bookmark}
\definecolor{linkcolour}{rgb}{0,0.2,0.6}
\hypersetup{
  draft=false,
  colorlinks,
  breaklinks,
  urlcolor=linkcolour,
  linkcolor=linkcolour
}

\setlength\bibitemsep{1em}

% -------------------------
% Small utility macros
% -------------------------
\newcommand{\IfNonEmptyURL}[2]{%
  \if\relax\detokenize{#1}\relax
  \else
    #2%
  \fi
}

% Backwards-compatible job environments (kept for safety)
\newenvironment{jobshort}[2]
{
    \begin{tabularx}{\linewidth}{@{}l X r@{}}
    \textbf{#1} & \hfill &  #2
    \end{tabularx} \par%
}
{
}

\newenvironment{joblong}[2]
{
    \begin{tabularx}{\linewidth}{@{}l X r@{}}
    \textbf{#1} & \hfill & #2
    \end{tabularx} \par%
    \begin{minipage}[t]{\linewidth}
    \begin{itemize}[nosep,after=\strut, leftmargin=1em, itemsep=3pt,label=--]
}
{
\end{itemize}
\end{minipage}
}

% activity listing environments (kept)
\newenvironment{activityshort}[2]
{
    \begin{tabularx}{\linewidth}{@{}l X r@{}}
    \textit{#1} & \hfill & #2
    \end{tabularx} \par%
}
{
}

\newcommand{\activitynone}[2][]{%
    \begin{tabularx}{\linewidth}{@{}l X r@{}}
    \textit{#1} & \hfill & #2
    \end{tabularx} \par%
}

% person macros (kept)
\newenvironment{personshort}[3][]%
{%
  \begin{tabularx}{\linewidth}{@{}l X r@{}}
    #2%
    \IfNonEmptyURL{#1}{\href{#1}{\ \small\faGoogleScholar}}%
    & \hfill & #3
  \end{tabularx}\par%
}%
{}


\newcommand{\personnone}[3][]{%
  \begin{tabularx}{\linewidth}{@{}l X r@{}}
    #2%
    \IfNonEmptyURL{#1}{\href{#1}{\ \small\faGoogleScholar}}%
    & \hfill & #3
  \end{tabularx} \par%
}

% typography tweaks for itemize
\renewcommand{\labelitemi}{}
\setlist[itemize,1]{leftmargin=0pt}
\setlength{\itemsep}{\tablerowskip}

% teaching column types
\newcolumntype{Y}{>{\raggedright\arraybackslash}p{0.53\textwidth}}
\newcolumntype{Z}{>{\raggedleft\arraybackslash}X}

\newcommand{\teachinstitution}[1]{%
  \multicolumn{2}{l}{\textbf{#1}}\\[\tablerowskip]%
}

\newcommand{\teachentry}[4]{%
  \emph{#1} & #3 \\%
  #2 &%
  \if\relax\detokenize{#4}\relax\else#4\fi%
  \\[\tablerowskip]%
}

% -------------------------
% New, compact macros (recommended)
% -------------------------
\RequirePackage{xparse}
\NewDocumentCommand{\cvcontact}{ m m m }{%
  \begin{tabularx}{\linewidth}{@{} l @{}}
  \Huge{#1} \\[7.5pt]
  #2 \\
  #3 \\
  \end{tabularx}
}

\NewDocumentCommand{\cvjob}{ m m o }{%
  % #1 = title, #2 = dates, [#3] = optional content (a token containing itemize or text)
  \begin{tabularx}{\linewidth}{@{}l X r@{}}
    \textbf{#1} & \hfill & #2
  \end{tabularx}\par%
  \IfValueT{#3}{\begin{minipage}[t]{\linewidth}#3\end{minipage}}%
}

\NewDocumentCommand{\cvperson}{ O{} m m }{%
  \begin{tabularx}{\linewidth}{@{}l X r@{}}
    #2%
    \IfNonEmptyURL{#1}{\href{#1}{\ \small\faGoogleScholar}}%
    & \hfill & #3
  \end{tabularx}\par%
}

%% end of cvstyle.sty