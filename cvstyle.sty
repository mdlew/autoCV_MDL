%% cvstyle.sty -- shared preamble, macros, and layout for cv.tex
\NeedsTeXFormat{LaTeX2e}
\ProvidesPackage{cvstyle}[2025/11/04 v1.1 MDL CV style]

% -------------------------
% Packages (grouped & ordered)
% -------------------------
% Basic helpers: URL handling, paragraph spacing
\RequirePackage{url}
\RequirePackage{parskip}

% Graphics & color (use xcolor; do not load `color` separately)
\RequirePackage{graphicx}
\RequirePackage[usenames,dvipsnames]{xcolor}
\RequirePackage[scale=0.9]{geometry}

% Page numbering / header & footer
\RequirePackage{lastpage}
\RequirePackage{fancyhdr}

% -------------------------
% Header/footer behavior
% -------------------------
% Mark section titles for footer
\makeatletter
\renewcommand{\sectionmark}[1]{\markright{#1}}
\renewcommand{\subsectionmark}[1]{\markright{#1}}
\makeatother

\pagestyle{fancy}
\renewcommand{\headrulewidth}{0pt}
\fancyhf{}
\fancyfoot[L]{\footnotesize MDL CV -- \nouppercase{\rightmark}}
\fancyfoot[R]{\footnotesize \thepage\ of \pageref{LastPage}}
\fancypagestyle{plain}{%
  \renewcommand{\headrulewidth}{0pt}%
  \fancyhf{}%
  \fancyfoot[L]{\footnotesize MDL CV -- \nouppercase{\rightmark}}%
  \fancyfoot[R]{\footnotesize \thepage\ of \pageref{LastPage}}%
}
\AtBeginDocument{\thispagestyle{empty}}

% -------------------------
% Layout helpers
% -------------------------
\RequirePackage{tabularx}
\newcommand{\tablerowskip}{3.75pt}

% Lists, enumerations, and reverse enumerations
\RequirePackage{enumitem}
\RequirePackage{etaremune}

% Small length used in a few places
\newlength{\fullcollw}
\setlength{\fullcollw}{0.47\textwidth}

% Section formatting and multi-column layout
\RequirePackage{titlesec}
\RequirePackage{multicol}

\titleformat{\section}{\Large\scshape\raggedright}{}{0em}{}[\titlerule]
\titlespacing{\section}{0pt}{10pt}{10pt}
\titleformat{\subsection}{\bfseries\raggedright}{}{0em}{}
\titlespacing{\subsection}{0pt}{10pt}{\tablerowskip}

% Icon + link helper
% Usage: \iconlink{<icon macro>}{<url>}{<text>}
\newcommand{\iconlink}[3]{\href{#2}{\raisebox{-0.05\height}{#1}\ #3}}

% -------------------------
% Bibliography
% -------------------------
% Keep the 'science' style and local modifications package
\RequirePackage[style=science, maxnames=99, articletitle=true, date=year, isbn=false, eprint=false, url=false]{biblatex}
\RequirePackage{biblatex_science_mods}

% -------------------------
% Icons, PDF/A and hyperlinks
% -------------------------
\RequirePackage{fontawesome7}
\RequirePackage[a-2b]{pdfx}
\RequirePackage[open]{bookmark}
\definecolor{linkcolour}{rgb}{0,0.2,0.6}
\hypersetup{
  draft=false,
  colorlinks,
  breaklinks,
  urlcolor=linkcolour,
  linkcolor=linkcolour
}

\setlength\bibitemsep{1em}

% -------------------------
% Small utility macros
% -------------------------
% If-non-empty helper specifically for optional URL arguments
\newcommand{\IfNonEmptyURL}[2]{%
  \if\relax\detokenize{#1}\relax
  \else
    #2%
  \fi
}

% activity listing environment
\newenvironment{activityshort}[2]
{
    \begin{tabularx}{\linewidth}{@{}l X r@{}}
    \textit{#1} & \hfill & #2
    \end{tabularx} \par%
}
{
}

\newcommand{\activitynone}[2][]{%
    \begin{tabularx}{\linewidth}{@{}l X r@{}}
    \textit{#1} & \hfill & #2
    \end{tabularx} \par%
}

% typography tweaks for itemize
\renewcommand{\labelitemi}{}
\setlist[itemize,1]{leftmargin=0pt}
\setlength{\itemsep}{\tablerowskip}

% teaching column types
\newcolumntype{Y}{>{\raggedright\arraybackslash}p{0.53\textwidth}}
\newcolumntype{Z}{>{\raggedleft\arraybackslash}X}

\newcommand{\teachinstitution}[1]{%
  \multicolumn{2}{l}{\textbf{#1}}\\[\tablerowskip]%
}

\newcommand{\teachentry}[4]{%
  \emph{#1} & #3 \\%
  #2 &%
  \if\relax\detokenize{#4}\relax\else#4\fi%
  \\[\tablerowskip]%
}

% -------------------------
% New, compact macros (public API)
% -------------------------
\RequirePackage{xparse}

% \cvcontact{<Name>}{<address/contact line>}{<links line>}
%   #1: full name (printed large)
%   #2: address/contact (single line)
%   #3: extra links (ORCID, website, scholar, etc.)
\NewDocumentCommand{\cvcontact}{ m m m }{%
  \begin{tabularx}{\linewidth}{@{} l @{}}
  \Huge{#1} \\[7.5pt]
  #2 \\
  #3 \\
  \end{tabularx}
}

% \cvjob{<title>}{<dates>}[<optional content>]
%   #1: job title / appointment text
%   #2: dates (string)
%   [#3]: optional content token (often an itemize or description block)
\NewDocumentCommand{\cvjob}{ m m o }{%
  \begin{tabularx}{\linewidth}{@{}l X r@{}}
    \textbf{#1} & \hfill & #2
  \end{tabularx}\par%
  \IfValueT{#3}{\begin{minipage}[t]{\linewidth}#3\end{minipage}}%
}

% \cvperson[<url>]{<name>}{<affiliation/status>}
%   Optional argument: URL (e.g., Google Scholar profile). If provided, a small icon link is added.
%   #2: name/title
%   #3: right-aligned text (dates, current position, etc.)
\NewDocumentCommand{\cvperson}{ O{} m m }{%
  \begin{tabularx}{\linewidth}{@{}l X r@{}}
    #2%
    \IfNonEmptyURL{#1}{\ \iconlink{\small\faGoogleScholar}{#1}{}}%
    & \hfill & #3
  \end{tabularx}\par%
}

%% end of cvstyle.sty